<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" href="css/main.css" type="text/css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

</head>

<body>
		
	<div id='wrapper'>
		<h1 id="header"></h1>
		
		<div id="game_settings">
			Select number of rows: <br>
			<select name="size">
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7" selected>7</option>
			</select>
	
			<button>New Game</button>
		</div>
	
		<div id='game'>
			<div id='tower1' class='tower'>
				<table id='A' class='droppable'> 
					<tr><td id='A7'></td></tr>
					<tr><td id='A6'><img id='level6' class='draggable' src='img/level6.png'></td></tr>
					<tr><td id='A5'><img id='level5' class='draggable' src='img/level5.png'></td></tr>
					<tr><td id='A4'><img id='level4' class='draggable' src='img/level4.png'></td></tr>
					<tr><td id='A3'><img id='level3' class='draggable' src='img/level3.png'></td></tr>
					<tr><td id='A2'><img id='level2' class='draggable' src='img/level2.png'></td></tr>
					<tr><td id='A1'><img id='level1' class='draggable' src='img/level1.png'></td></tr>
					<tr><td id='A0'><img id='level0' class='draggable' src='img/level0.png'></td></tr>
				</table>
			</div>	
				
			<div id='tower2' class='tower'>
				<table id='B' class='droppable'> 
					<tr><td id='B7'></td></tr>
					<tr><td id='B6'></td></tr>
					<tr><td id='B5'></td></tr>
					<tr><td id='B4'></td></tr>
					<tr><td id='B3'></td></tr>
					<tr><td id='B2'></td></tr>
					<tr><td id='B1'></td></tr>
					<tr><td id='B0'></td></tr>
				</table>
			</div>
			
			<div id='tower3' class='tower'>
				<table id='C' class='droppable'> 
					<tr><td id='C7'></td></tr>
					<tr><td id='C6'></td></tr>
					<tr><td id='C5'></td></tr>
					<tr><td id='C4'></td></tr>
					<tr><td id='C3'></td></tr>
					<tr><td id='C2'></td></tr>
					<tr><td id='C1'></td></tr>
					<tr><td id='C0'></td></tr>
				</table>
			</div>	
		</div>
		<h2 id="instructions">Use mouse to move blocks. Move all blocks to right-most tower to win.</h2>
		
		<div id="moves_display">
			<div id="min">123</div>
			
			<div id="curr">456</div>
		</div>
		
	</div>
	
	
	
	
	
	
	
	<script>
	const MAX_SIZE = 7;
	var number_of_moves;
	var minimum_number_of_moves = [0, 1 , 3, 7, 15, 31, 63, 127];
	image_objects = new Array();
	
	for (var i = 0; i < MAX_SIZE; i++)
		image_objects[i] = $("#level" + i).get();
	
	
	var $game = new TowersOfHanoi("start");
	
	function TowersOfHanoi(size)
	{	
		var game_end = false;
		const GAME_SIZE = size == "start" ? MAX_SIZE : size;
		const NUM_TOWERS = 3;
		var origin;
		
		number_of_moves = 0;
		
		tower = [];
		tower["A"] = new Array();
		tower["B"] = new Array();
		tower["C"] = new Array();
		
		var pos = [];				// store the last position of each block in array pos
		
		initialize();
		
		$(function() {
		    $( '.draggable' ).draggable({
		    	containment: '#game', 
		    	revert: "invalid",
		    	start: function() {
		    		if (game_end)
		    			return false;
		    		
		    		$('#' + pos[this.id][0]).droppable("disable");		// cannot drop in origin tower
		    		
		    		// do not drop over smaller....
		    		for (var t in tower)
		    		{
		    			top_level = tower[t].length - 1;
		    			
		    			if (this.id <= tower[t][top_level]) // if this is not bigger than peak ABC, disable draggable
		    				$("#" + t).droppable("disable");
		    		}
		    		
		    		if (!(this.id == tower["A"][ (tower["A"].length - 1) ] || this.id == tower["B"][(tower["B"].length - 1)] || this.id == tower["C"][(tower["C"].length - 1)]))
		    			return false;
		    		
		    		
		    	}, // end start: function
		    	
		    	stop: function() {
		    		for (var t in tower)				// restore droppable in all towers
		    			$('#' + t).droppable("enable");
		    		
		    	}
		    }
	 	);
		    $( ".droppable" ).droppable({
		    	activeClass: "active",
		    	drop: function( event, ui ) {
		    		processMove(event, ui, this.id);
		    		number_of_moves++;
		    	}
		    });
		});
			
		function initialize()
		{
			if (size != "start")
			{
				for (var letter in tower)
				{
					for (var i = 0; i < MAX_SIZE; i++)
						$("#" + letter + i).html("");
				}
			}
			
			
			for (var i = 0; i < (GAME_SIZE); i++)
			{
					pos['level' + i] = ['A', i, 'A'+i];		// [0] current tower, [1] the current level.
					tower["A"][i] = 'level' + i;
					
					if (size !=  "number")
						$("#A" + i).html(image_objects[i]);
			}
		}
			
		function processMove(event, ui, target)
		{
			obj = event.toElement;  	// detect obj we are moving
			origin = pos[obj.id][0];
			addToTower(obj, target);
			
			if (tower["C"].length == GAME_SIZE)
			{
				game_end = true;
				alert('       YOU WIN!!\nTo play again click "New Game" button');
			}
		}
		
		function addToTower(obj, target)
		{
			var height
			// here
			height = tower[target].length;		
			
			destination_row = "" + target + height;
			$('#' + obj.id).css({'left': 0, 'top': 0});			// ensures image stays inside of <td>
			$('#' + destination_row).html(obj);
			
		
			pos[obj.id] = [target, height, destination_row];
			tower[target][height] = tower[origin].pop();
			
			
			pos[obj.id] = [target, height, destination_row];		// update the position coordinates of the element just dropped
		}
	}	
	
	$(document).ready(function(){ 
	    $("button").click(function () {
	        var new_size = $("select[name=size]").val();
	        $game = new TowersOfHanoi(new_size);
	    });
	});

  </script>
	
	
	
	
</body>

</html>