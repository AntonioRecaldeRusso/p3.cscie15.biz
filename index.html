<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" href="css/main.css" type="text/css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

<script>
	game_size = 7;
	
	var height_A = 7;				// top level of tower A
	var height_B = 0;				// top level of tower B
	var height_C = 0;				// top level of tower C
	
	board = [];
	board["A"] = new Array();
	board["B"] = new Array();
	board["C"] = new Array();
	
	var pos = [];				// store the last position of each block in array pos
	var drag_count = 0;
	
	initialize();
	
 	$(function() {
	    $( '.draggable' ).draggable({
	    	containment: '#game', 
	    	revert: "invalid",
	    	start: function() {
	    		$('#' + pos[this.id][0]).droppable('option', 'disabled', true);
	    	},
	    	drag: function(event, ui) {
	    		
	    		// abort drag logic here	
	    	}
	    }
 	);
	    $( ".droppable" ).droppable({
	      	drop: function( event, ui ) {
	      		$('#' + pos[event.toElement.id][0]).droppable('option', 'disabled', false);
	    		validateMove(event, ui, this.id);
	      }
	    });
	});
		
	function initialize()
	{
		for (var i = 0; i < (game_size); i++)
			{
				pos['level' + i] = ['A', i];		// [0] current tower, [1] the current level.
				board["A"][i] = 'level' + i;
				console.log(board["A"][i]);
			}
			
		
	}
		
	function validateMove(event, ui, target)
	{
		object = detectObject(event);  	// detect object we are moving
		origin = pos[object.id][0];
		console.log("origin " + origin);
		console.log("target " + target);

		addToTower(object, target);	
	}
	
	function detectObject(event)
	{
		moving_obj = event.toElement;
		return moving_obj;	
	}
	
	function addToTower(object, target)
	{
		var height
		
		switch (object.title) {
		case 'A':
			height_A--;
			console.log('origin tower a now: ' + height_A);
			break;
		case 'B':
			height_B--;
			console.log('origin tower b now: ' + height_B);
			break;
		case 'C':
			height_C--;
			console.log('origin tower c now: ' + height_C);
			break;
		}
		
		
		switch (target) {
		case 'A':
			height = height_A++;
			console.log('tower a now: ' + height_A);
			break; 
			
		case 'B':
			height = height_B++;
			console.log('tower b now: ' + height_B);
			break;
			
		case 'C':
			height = height_C++;
			console.log('tower c now: ' + height_C);
			break;
		}
		
		destination_row = "" + target + height;
		console.log(object);
		$('#' + object.id).css({'left': 0, 'top': 0});			// ensures image stays inside of <td>
		$('#' + object.id).attr('title', target);
		$('#' + destination_row).html(object);
		
		
		/**
		 *	This method updates the values associated with each level block of the tower
		 * 	E.g. If block "level7" just moved to position "B0", the array "pos[][]" should reflect that change.
		 * 	It also updates the draggable state of the blocks at the peak positions of each tower.
		 *	
		 */
		updateTowers(object.id, target, height, destination_row);
	}
	
	function updateTowers(object_id, target, height, last_destination)
	{
		pos[object_id] = [target, height, last_destination];		// update the position coordinates of the element just dropped
	}
  </script>


</head>

<body>
	<div id='wrapper'>
	
		<div id='game'>
			<div id='tower1' class='tower'>
				<table id='A' class='droppable'> 
					<tr><td id='A7'></td></tr>
					<tr><td id='A6'><img id='level6' title='A' class='draggable ui-state-highlight' src='img/level6.png'></td></tr>
					<tr><td id='A5'><img id='level5' title='A' class='draggable ui-state-highlight' src='img/level5.png'></td></tr>
					<tr><td id='A4'><img id='level4' title='A' class='draggable ui-state-highlight' src='img/level4.png'></td></tr>
					<tr><td id='A3'><img id='level3' title='A' class='draggable ui-state-highlight' src='img/level3.png'></td></tr>
					<tr><td id='A2'><img id='level2' title='A' class='draggable ui-state-highlight' src='img/level2.png'></td></tr>
					<tr><td id='A1'><img id='level1' title='A' class='draggable ui-state-highlight' src='img/level1.png'></td></tr>
					<tr><td id='A0'><img id='level0' title='A' class='draggable ui-state-highlight' src='img/level0.png'></td></tr>
				</table>
			</div>	
				
			<div id='tower2' class='tower'>
				<table id='B' class='droppable'> 
					<tr><td id='B7'></td></tr>
					<tr><td id='B6'></td></tr>
					<tr><td id='B5'></td></tr>
					<tr><td id='B4'></td></tr>
					<tr><td id='B3'></td></tr>
					<tr><td id='B2'></td></tr>
					<tr><td id='B1'></td></tr>
					<tr><td id='B0'></td></tr>
				</table>
			</div>
			
			<div id='tower3' class='tower'>
				<table id='C' class='droppable'> 
					<tr><td id='C7'></td></tr>
					<tr><td id='C6'></td></tr>
					<tr><td id='C5'></td></tr>
					<tr><td id='C4'></td></tr>
					<tr><td id='C3'></td></tr>
					<tr><td id='C2'></td></tr>
					<tr><td id='C1'></td></tr>
					<tr><td id='C0'></td></tr>
				</table>
			</div>	
		</div>
	
	</div>
</body>

</html>
