<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" href="css/main.css" type="text/css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

<script>
	const GAME_SIZE = 7;
	const NUM_TOWERS = 3;
	
	board = [];
	board["A"] = new Array();
	board["B"] = new Array();
	board["C"] = new Array();
	
	height_A = board ["A"]["height"] = 7;				// top level of tower A
	height_B = board ["B"]["height"] = 0;				// top level of tower B
	height_C = board ["C"]["height"] = 0;				// top level of tower C
	
	
	var pos = [];				// store the last position of each block in array pos
	
	initialize();
	
	$(function() {
	    $( '.draggable' ).draggable({
	    	containment: '#game', 
	    	revert: "invalid",
	    	start: function() {
	    		console.log(pos[this.id]);
	    		$('#' + pos[this.id][0]).droppable("disable");		// cannot drop in origin tower
	    		
	    		// do not drop over smaller....
	    		for (var tower in board)
	    		{
	    			top_level = board[tower]["height"] - 1;
	    			
	    			console.log("top level " + tower + " " + board[tower][top_level]);
	    			console.log("this.id " + this.id);
	    			
	    			if (this.id <= board[tower][top_level]) // if this is not bigger than peakA, disable draggable
	    				$("#" + tower).droppable("disable");
	    		}
	    		
	    		if (!(this.id == board["A"][ (board["A"]["height"] - 1) ] || this.id == board["B"][(board["B"]["height"] - 1)] || this.id == board["C"][(board["C"]["height"] - 1)]))
	    		{
	    			console.log("inside if statement");
	    			return false;
	    		}
	    		
	    	}, // end start: function
	    	
	    	stop: function() {
	    		
	    		for (var tower in board)				// restore droppable in all towers
	    			$('#' + tower).droppable("enable");
	    		
	    	}
	    }
 	);
	    $( ".droppable" ).droppable({
	    	activeClass: "active",
	    	drop: function( event, ui ) {
	    		processMove(event, ui, this.id);
	      }
	    });
	});
		
	function initialize()
	{
		for (var i = 0; i < (GAME_SIZE); i++)
			{
				pos['level' + i] = ['A', i, 'A'+i];		// [0] current tower, [1] the current level.
				board["A"][i] = 'level' + i;
			}
	}
		
	function processMove(event, ui, target)
	{
		object = detectObject(event);  	// detect object we are moving
		origin = pos[object.id][0];
		addToTower(object, target);	
	}
	
	function detectObject(event)
	{
		moving_obj = event.toElement;
		return moving_obj;	
	}
	
	function addToTower(object, target)
	{
		var height
		var origin = pos[object.id][0]; console.log("origin " + origin);
		
		board[ (pos[object.id][0]) ]["height"]--;		
		height = board[target]["height"]++;		
		
		destination_row = "" + target + height;
		$('#' + object.id).css({'left': 0, 'top': 0});			// ensures image stays inside of <td>
		$('#' + destination_row).html(object);
		
	
		pos[object.id] = [target, height, destination_row];
		board[target][height] = board[origin].pop();
		console.log(board[target]);
		console.log(pos[board[target][height]]);
		
		/**
		 *	This method updates the values associated with each level block of the tower
		 * 	E.g. If block "level7" just moved to position "B0", the array "pos[][]" should reflect that change.
		 * 	It also updates the draggable state of the blocks at the peak positions of each tower.
		 *	
		 */
		updateTowers(object.id, target, height, destination_row);
	}
	
	function updateTowers(object_id, target, height, last_destination)
	{
		pos[object_id] = [target, height, last_destination];		// update the position coordinates of the element just dropped
	}
	
  </script>


</head>

<body>
	<div id='wrapper'>
	
		<div id='game'>
			<div id='tower1' class='tower'>
				<table id='A' class='droppable'> 
					<tr><td id='A7'></td></tr>
					<tr><td id='A6'><img id='level6' class='draggable ui-widget-content' src='img/level6.png'></td></tr>
					<tr><td id='A5'><img id='level5' class='draggable ui-widget-content' src='img/level5.png'></td></tr>
					<tr><td id='A4'><img id='level4' class='draggable ui-widget-content' src='img/level4.png'></td></tr>
					<tr><td id='A3'><img id='level3' class='draggable ui-widget-content' src='img/level3.png'></td></tr>
					<tr><td id='A2'><img id='level2' class='draggable ui-widget-content' src='img/level2.png'></td></tr>
					<tr><td id='A1'><img id='level1' class='draggable ui-widget-content' src='img/level1.png'></td></tr>
					<tr><td id='A0'><img id='level0' class='draggable ui-widget-content' src='img/level0.png'></td></tr>
				</table>
			</div>	
				
			<div id='tower2' class='tower'>
				<table id='B' class='droppable'> 
					<tr><td id='B7'></td></tr>
					<tr><td id='B6'></td></tr>
					<tr><td id='B5'></td></tr>
					<tr><td id='B4'></td></tr>
					<tr><td id='B3'></td></tr>
					<tr><td id='B2'></td></tr>
					<tr><td id='B1'></td></tr>
					<tr><td id='B0'></td></tr>
				</table>
			</div>
			
			<div id='tower3' class='tower'>
				<table id='C' class='droppable'> 
					<tr><td id='C7'></td></tr>
					<tr><td id='C6'></td></tr>
					<tr><td id='C5'></td></tr>
					<tr><td id='C4'></td></tr>
					<tr><td id='C3'></td></tr>
					<tr><td id='C2'></td></tr>
					<tr><td id='C1'></td></tr>
					<tr><td id='C0'></td></tr>
				</table>
			</div>	
		</div>
	
	</div>
</body>

</html>
